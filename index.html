<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hub Industrial OPC UA | 3R Systems</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@500;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div id="app">
        <header>
            <div class="logo">
                <i class="fas fa-microchip"></i>
                <span>Centro de Control OPC-UA</span>
            </div>
            <div class="status-bar">
                <div class="status-item">
                    <span class="indicator"></span>
                    <span>SERVIDOR: ACTIVO</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-shield-halved" style="color: var(--secondary)"></i>
                    <span>CIFRADO: AES-256</span>
                </div>
                <div class="status-item" id="system-time">
                    16:45:01
                </div>
            </div>
        </header>

        <aside class="sidebar">
            <h3>Explorador de Nodos</h3>
            <ul class="node-tree" id="address-space">
                <li class="node-item" onclick="app.selectNode(this, 'Root')"><i class="fas fa-folder"></i> Raíz (Root)
                </li>
                <li class="node-children">
                <li class="node-item" onclick="app.selectNode(this, 'Objects')"><i class="fas fa-folder"></i> Objetos
                </li>
                <li class="node-children">
                <li class="node-item" onclick="app.selectNode(this, 'S7_1500')"><i class="fas fa-cube"></i>
                    Siemens_S7_1500</li>
                <li class="node-children">
                <li class="node-item" onclick="app.selectNode(this, 'Temp')"><i class="fas fa-tag"></i> Temperatura</li>
                <li class="node-item" onclick="app.selectNode(this, 'Pres')"><i class="fas fa-tag"></i> Presión</li>
                <li class="node-item" onclick="opc.callMethod('Reset')"><i class="fas fa-bolt"></i> Reiniciar()</li>
                </li>
                <li class="node-item" onclick="app.selectNode(this, 'Vib')"><i class="fas fa-waveform"></i>
                    Sensor_Vibración_01</li>
                </li>
                </li>
            </ul>
        </aside>

        <main>
            <div class="grid-dashboard">
                <!-- Siemens PLC Card -->
                <div class="card" id="card-plc">
                    <div class="card-header">
                        <span class="card-title"><i class="fas fa-industry"></i> PLC SIEMENS S7-1500</span>
                        <span class="live-indicator indicator"></span>
                    </div>
                    <div>
                        <span class="value-display" id="plc-temp">00.0</span>
                        <span class="unit">°C</span>
                    </div>
                    <div class="chart-container" id="plc-chart">
                        <!-- Barras dinámicas -->
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn" onclick="opc.callMethod('Reset')">REINICIAR PLC</button>
                        <button class="btn btn-primary" id="btn-iniciar" onclick="opc.callMethod('Iniciar')">INICIAR
                            PROCESO</button>
                    </div>
                </div>

                <!-- Vibration Sensor Card -->
                <div class="card" id="card-vibration">
                    <div class="card-header">
                        <span class="card-title"><i class="fas fa-vibration"></i> NIVEL DE VIBRACIÓN (RMS)</span>
                    </div>
                    <div>
                        <span class="value-display" id="vib-rms" style="color: var(--secondary)">0.000</span>
                        <span class="unit">mm/s</span>
                    </div>
                    <div class="chart-container" id="vib-chart">
                    </div>
                </div>

                <!-- Audit Log Card -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-header">
                        <span class="card-title"><i class="fas fa-list-ul"></i> REGISTRO DE EVENTOS (IEC 62541)</span>
                        <button class="btn" style="font-size: 0.7rem;" onclick="app.clearLogs()">LIMPIAR</button>
                    </div>
                    <div id="audit-log"
                        style="height: 150px; overflow-y: auto; font-family: 'JetBrains Mono'; font-size: 0.8rem; line-height: 1.5;">
                        <!-- Registros aquí -->
                    </div>
                </div>
            </div>
        </main>

        <aside class="right-panel">
            <h3>Atributos del Nodo</h3>
            <div id="node-details"
                style="min-height: 100px; border-bottom: 1px solid #30363d; margin-bottom: 20px; padding-bottom: 15px;">
                <p style="font-size: 0.8rem; color: var(--text-dim); font-style: italic;">Seleccione un nodo para
                    inspeccionar sus
                    atributos OPC UA.</p>
            </div>

            <h3>Panel de Seguridad</h3>
            <div class="security-badge">
                <i class="fas fa-check-circle"></i> VERIFICADO POR PKI
            </div>

            <div style="margin-bottom: 25px;">
                <p style="font-size: 0.8rem; color: var(--text-dim);">URI de Aplicación:</p>
                <p style="font-size: 0.75rem; word-break: break-all; margin-top: 5px;">
                    urn:3r-industria:opcua:servidor:m2m</p>
            </div>

            <div style="margin-bottom: 25px;">
                <p style="font-size: 0.8rem; color: var(--text-dim);">Estado del Certificado X.509:</p>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                    <span style="font-size: 0.8rem;">Válido hasta: 2027-02-27</span>
                    <i class="fas fa-certificate" style="color: var(--warning)"></i>
                </div>
            </div>

            <h3>Transporte M2M</h3>
            <div class="card" style="margin-top: 10px; background: rgba(255,255,255,0.05);">
                <p style="font-size: 0.8rem;">Perfil: <b>OPC-TCP Binario</b></p>
                <p style="font-size: 0.8rem; margin-top: 5px;">Endpoint: <br><code
                        id="opc-endpoint">opc.tcp://localhost:4840</code></p>
            </div>

            <div style="margin-top: 20px;">
                <button class="btn btn-primary" style="width: 100%;" onclick="app.toggleRedundancy()">REDUNDANCIA
                    ACTIVADA</button>
            </div>
        </aside>

        <footer
            style="grid-column: 1 / -1; background: var(--surface-header); display: flex; align-items: center; padding: 0 20px; font-size: 0.7rem; color: var(--text-dim); border-top: 1px solid #30363d;">
            &copy; 2026 3R Industria - Arquitectura OPC UA v2.5.41 (Optimizado para M2M)
        </footer>
    </div>

    <script src="opc-engine.js"></script>
    <script src="app.js"></script>
</body>

</html>